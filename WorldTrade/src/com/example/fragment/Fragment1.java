package com.example.fragment;import java.util.ArrayList;import java.util.List;import org.apache.http.NameValuePair;import org.apache.http.message.BasicNameValuePair;import org.json.JSONArray;import org.json.JSONException;import org.json.JSONObject;import com.example.worldtrade.R;import com.lidroid.xutils.HttpUtils;import com.lidroid.xutils.exception.HttpException;import com.lidroid.xutils.http.RequestParams;import com.lidroid.xutils.http.ResponseInfo;import com.lidroid.xutils.http.callback.RequestCallBack;import com.lidroid.xutils.http.client.HttpRequest;import com.nostra13.universalimageloader.core.DisplayImageOptions;import com.nostra13.universalimageloader.core.ImageLoader;import com.nostra13.universalimageloader.core.display.FadeInBitmapDisplayer;import com.tianshicoffeeom.app.imgscroll.MyImgScroll;import android.annotation.SuppressLint;import android.content.Intent;import android.graphics.Bitmap;import android.os.Bundle;import android.support.annotation.Nullable;import android.support.v4.app.Fragment;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.view.View.OnClickListener;import android.widget.AdapterView;import android.widget.BaseAdapter;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.ListView;import android.widget.RelativeLayout;import android.widget.TextView;import android.widget.AdapterView.OnItemClickListener;import android.widget.ImageView.ScaleType;import android.widget.Toast;@SuppressLint("NewApi")public class Fragment1 extends Fragment{	protected ImageLoader imageLoader = ImageLoader.getInstance();	private View parentView;	private MyImgScroll myPager;	private LinearLayout ovalLayout;	private ArrayList<View> listViews;	private RelativeLayout mRlf11;	private RelativeLayout mRlf12;    private boolean flag =false;	private ListView mLvf11;    private ArrayList<Data> mDataList_origin=new ArrayList<Fragment1.Data>();    private ArrayList<Data> mDataList=new ArrayList<Fragment1.Data>();	private DisplayImageOptions options;	private Myadapter myadapter;	@Override	@Nullable	public View onCreateView(LayoutInflater inflater,			@Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {		parentView = inflater.inflate(R.layout.fragment1, container, false);				myPager = (MyImgScroll)parentView. findViewById(R.id.myvp);		ovalLayout = (LinearLayout) parentView. findViewById(R.id.vb);		InitViewPager();//初始化图片		//开始滚动		myPager.start(getActivity(), listViews, 4000, ovalLayout,				R.layout.ad_bottom_item, R.id.ad_item_v,				R.drawable.dot_focused, R.drawable.dot_normal);		mRlf11 =(RelativeLayout)parentView.findViewById(R.id.mRlf11);		mRlf12 =(RelativeLayout)parentView.findViewById(R.id.mRlf12);		mRlf11.setOnClickListener(listener);		mRlf12.setOnClickListener(listener);		mLvf11 =(ListView)parentView.findViewById(R.id.mLvf11);				initData();				return parentView;	}	private void initData() {		downloadsearch("0");	}	public void downloadsearch(String area11){		 RequestParams params = new RequestParams();       List<NameValuePair> nameValuePairs=new ArrayList<NameValuePair>(10);       nameValuePairs.add(new BasicNameValuePair("PropertyLocation", area11));       nameValuePairs.add(new BasicNameValuePair("RentSale", "1"));       params.addBodyParameter(nameValuePairs);       HttpUtils http = new HttpUtils();       http.send(HttpRequest.HttpMethod.POST,      		 com.example.utils.Content.URL_Search,               params,               new RequestCallBack<String>() {					@Override					public void onFailure(HttpException arg0, String arg1) {						// TODO Auto-generated method stub											}					@Override					public void onSuccess(ResponseInfo<String> arg0) {						JSONObject jsonObject;						try {							jsonObject = new JSONObject(arg0.result);							String string_code = jsonObject.getString("code");							 int  num_code=Integer.valueOf(string_code);							 if (num_code==1) {								 //保存到本地								 mDataList_origin.clear();								 JSONArray array = jsonObject.getJSONArray("data");								  for (int i = 0; i < array.length(); i++) {									  									  Data  data=new Data();									  									 JSONObject jsonObject2 = array.getJSONObject(i);									 data.ID= jsonObject2.getString("ID");									 data.Name= jsonObject2.getString("Name");									 data.StreetName = jsonObject2.getString("StreetName");									 data.AreaGross=jsonObject2.getString("AreaGross");									 data.AreaNet=jsonObject2.getString("AreaNet");									 data.CoverPic=jsonObject2.getString("CoverPic");									 data.SellingPrice=jsonObject2.getString("SellingPrice");									 data.RentPrice=jsonObject2.getString("RentPrice");									 mDataList_origin.add(data);									 			                          data.toString();						 								}								  mDataList.clear();								  mDataList.addAll(mDataList_origin);									if (mDataList_origin.size()==0) {										parentView.findViewById(R.id.tv_noresut).setVisibility(View.VISIBLE);									}									else {										parentView.findViewById(R.id.tv_noresut).setVisibility(View.GONE);									}								  initListView();							}							 else {								 parentView.findViewById(R.id.progressBar_sale).setVisibility(View.GONE);								//new AlertInfoDialog(SaleActivity.this).show();							}						} catch (JSONException e) {							 if(mDataList.isEmpty())							//new Dialog_noInternet(SaleActivity.this).show();								 Toast.makeText(getActivity(), "o相P热", 0).show();							e.printStackTrace();						}																							}				                });	}		private void initListView() {		 parentView.findViewById(R.id.progressBar_sale).setVisibility(View.GONE);		 mLvf11.setVisibility(View.VISIBLE);	       myadapter = new Myadapter();	       mLvf11.setAdapter(myadapter);	       mLvf11.setOnItemClickListener(new OnItemClickListener() {				@Override				public void onItemClick(AdapterView<?> parent,						View view, int position, long id) {				}			});		}	private void initImageLoaderOptions() {		options = new DisplayImageOptions.Builder()				.showImageForEmptyUri(R.drawable.a)				.cacheInMemory()				.cacheOnDisc().displayer(new FadeInBitmapDisplayer(2000))				.bitmapConfig(Bitmap.Config.RGB_565).build();	}	class Holder{		TextView mTvri10,mTvri11,mTvri12;		ImageView imageView;	}	class  Myadapter extends   BaseAdapter{		@Override		public View getView(int position, View convertView, ViewGroup parent) {			        						Holder holder = null;			if(convertView==null){				convertView = LayoutInflater.from(getActivity())						.inflate(R.layout.item_listview_1, null);				holder = new Holder();				holder.mTvri10 =(TextView)convertView.findViewById(R.id.mTvri10);				holder.mTvri11 =(TextView)convertView.findViewById(R.id.mTvri11);				holder.mTvri12 =(TextView)convertView.findViewById(R.id.mTvri12);				holder.imageView =(ImageView)convertView.findViewById(R.id.iv_listview_rent_pic);				convertView.setTag(holder);				}else{				holder =(Holder)convertView.getTag();			}			holder.mTvri11.setText(mDataList.get(position).Name);			initImageLoaderOptions();			imageLoader.displayImage(mDataList.get(position).CoverPic,					holder.imageView, options);						return convertView;		}		@Override		public int getCount() {			// TODO Auto-generated method stub			return mDataList.size();		}		@Override		public Object getItem(int position) {			// TODO Auto-generated method stub			return null;		}		@Override		public long getItemId(int position) {			// TODO Auto-generated method stub			return 0;		}	}	class Data{		String   ID;		String   Name;		String   StreetName;		String   AreaGross;		String   AreaNet;		String   SellingPrice;		String   RentPrice;		String   CoverPic;		@Override		public String toString() {			return "Data [ID=" + ID + ", Name=" + Name + ", StreetName="					+ StreetName + ", AreaGross=" + AreaGross + ", AreaNet="					+ AreaNet + ", SellingPrice=" + SellingPrice					+ ", RentPrice=" + RentPrice + ", CoverPic=" + CoverPic					+ "]";		}			}	OnClickListener listener =new OnClickListener() {				@Override		public void onClick(View v) {			switch (v.getId()) {			case R.id.mRlf11:				if(flag){					mRlf11.setBackground(getResources().getDrawable(R.drawable.aa7));					mRlf12.setBackground(getResources().getDrawable(R.drawable.aa8));				}				break;			case R.id.mRlf12:				flag =true;				mRlf11.setBackground(getResources().getDrawable(R.drawable.aa8));				mRlf12.setBackground(getResources().getDrawable(R.drawable.aa7));				break;			default:				break;			}		}	};	private void InitViewPager() {		listViews = new ArrayList<View>();		int[] imageResId = new int[] { R.drawable.a, R.drawable.c,				 R.drawable.a, R.drawable.c,  R.drawable.a };		for (int i = 0; i < imageResId.length; i++) {			ImageView imageView = new ImageView(getActivity());			imageView.setOnClickListener(new OnClickListener() {				public void onClick(View v) {// 设置图片点击事件				}			});			imageView.setImageResource(imageResId[i]);			imageView.setScaleType(ScaleType.CENTER_CROP);			listViews.add(imageView);		}	}	}