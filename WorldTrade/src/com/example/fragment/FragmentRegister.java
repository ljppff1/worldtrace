package com.example.fragment;import java.util.ArrayList;import java.util.List;import org.apache.http.NameValuePair;import org.apache.http.message.BasicNameValuePair;import org.json.JSONArray;import org.json.JSONException;import org.json.JSONObject;import com.easemob.chat.EMChatManager;import com.easemob.exceptions.EaseMobException;import com.example.worldtrade.MainActivity;import com.example.worldtrade.MainActivity1;import com.example.worldtrade.MainActivity2;import com.example.worldtrade.MainActivity3;import com.example.worldtrade.R;import com.lidroid.xutils.HttpUtils;import com.lidroid.xutils.exception.HttpException;import com.lidroid.xutils.http.RequestParams;import com.lidroid.xutils.http.ResponseInfo;import com.lidroid.xutils.http.callback.RequestCallBack;import com.lidroid.xutils.http.client.HttpRequest;import com.nostra13.universalimageloader.core.DisplayImageOptions;import com.nostra13.universalimageloader.core.ImageLoader;import com.nostra13.universalimageloader.core.display.FadeInBitmapDisplayer;import android.app.Activity;import android.app.AlertDialog;import android.app.AlertDialog.Builder;import android.app.Dialog;import android.content.DialogInterface;import android.content.Intent;import android.content.SharedPreferences;import android.graphics.Bitmap;import android.graphics.Color;import android.os.Bundle;import android.support.annotation.Nullable;import android.support.v4.app.Fragment;import android.text.SpannableString;import android.text.Spanned;import android.text.TextPaint;import android.text.TextUtils;import android.text.method.LinkMovementMethod;import android.text.style.ClickableSpan;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.view.View.OnClickListener;import android.widget.AdapterView;import android.widget.BaseAdapter;import android.widget.Button;import android.widget.EditText;import android.widget.ImageView;import android.widget.ListView;import android.widget.ProgressBar;import android.widget.RadioButton;import android.widget.RadioGroup;import android.widget.TextView;import android.widget.Toast;import android.widget.AdapterView.OnItemClickListener;import android.widget.RadioGroup.OnCheckedChangeListener;public class FragmentRegister extends Fragment  {private TextView mTvreg2;private TextView mTvreg1;private EditText mEtfr1;private EditText mEtfr3;private EditText mEtfr4;private Button ui_login_btn;private ProgressBar progressBar_sale;private TextView mTvr21;private EditText mEtfr2;private RadioButton mRb1;private RadioButton mRb2;private RadioGroup mRg1;private int iwechatNo =1;private TextView mTvreg24;private TextView mTvreg24b;private List<Data1> listd1 =new ArrayList<FragmentRegister.Data1>();private String[] listd1s =new String[]{};private int ilistd1=-1;private List<Data2> listd2 =new ArrayList<FragmentRegister.Data2>();private String[] listd2s =new String[]{};private int ilistd2=-1;private List<Data3> listd3 =new ArrayList<FragmentRegister.Data3>();private String[] listd3s =new String[]{};private int ilistd3=-1;private TextView mTvreg244;private String CHINESE;private View view;@Override@Nullablepublic View onCreateView(LayoutInflater inflater,		@Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {		SharedPreferences mySharedPreferences1= getActivity().getSharedPreferences("USER", Activity.MODE_PRIVATE); 		CHINESE =mySharedPreferences1.getString("CHINESE","1");		if(CHINESE.equals("1")){			view = inflater.inflate(R.layout.fragmentregister, container, false);		}else{			view = inflater.inflate(R.layout.fragmentregistere, container, false);		}		progressBar_sale =(ProgressBar)view.findViewById(R.id.progressBar_sale);		progressBar_sale.setVisibility(View.GONE);				mTvreg2 = (TextView)view.findViewById(R.id.mTvreg2);		mTvreg2.setOnClickListener(listener);		mTvreg24 = (TextView)view.findViewById(R.id.mTvreg24);		mTvreg24.setOnClickListener(listener);		mTvreg244 = (TextView)view.findViewById(R.id.mTvreg244);		mTvreg244.setOnClickListener(listener);				mTvreg24b = (TextView)view.findViewById(R.id.mTvreg24b);		mTvreg24b.setOnClickListener(listener);		mTvreg1 = (TextView)view.findViewById(R.id.mTvreg1);		mTvreg1.setOnClickListener(listener);		mEtfr1=(EditText)view.findViewById(R.id.mEtfr1);		mEtfr2 =(EditText)view.findViewById(R.id.mEtfr2);		mRb1 =(RadioButton)view.findViewById(R.id.mRb1);		mRb2 =(RadioButton)view.findViewById(R.id.mRb2);		mRg1 =(RadioGroup)view.findViewById(R.id.mRg1);		mRg1.setOnCheckedChangeListener(new OnCheckedChangeListener() {			@Override			public void onCheckedChanged(RadioGroup group, int cheakedId) {				if (cheakedId == mRb1.getId()) {					iwechatNo=1;				} else if (cheakedId == mRb2.getId()) {					iwechatNo=2;				}										}		});		mRb1.setChecked(true);        iwechatNo=1;		mEtfr3=(EditText)view.findViewById(R.id.mEtfr3);		mEtfr4=(EditText)view.findViewById(R.id.mEtfr4);		ui_login_btn =(Button)view.findViewById(R.id.ui_login_btn);		ui_login_btn.setOnClickListener(listener);		mTvr21 =(TextView)view.findViewById(R.id.mTvr21);        String url_0_text = "[私嘞蘼明";        String url_1_text = "使用l款t";        String url_2_text = "按以上登I即代表意接受  World Trade  之   ";        String url_3_text = "  及  ";        String url_4_text = "  所s束";                mTvr21.setText("按以上[登]I即代表意接受 World Trade 之  ");        SpannableString spStr = new SpannableString(url_0_text);        spStr.setSpan(new ClickableSpan() {            @Override            public void updateDrawState(TextPaint ds) {                super.updateDrawState(ds);                ds.setColor(Color.WHITE);       //设置文件颜色                ds.setUnderlineText(true);      //设置下划线            }            @Override            public void onClick(View widget) {            }        }, 0, url_0_text.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);       // mTvr21.setHighlightColor(Color.TRANSPARENT); //设置点击后的颜色为透明，否则会一直出现高亮        mTvr21.append(spStr);        mTvr21.append(url_3_text);        SpannableString spStr1 = new SpannableString(url_1_text);        spStr1.setSpan(new ClickableSpan() {            @Override            public void updateDrawState(TextPaint ds) {                super.updateDrawState(ds);                ds.setColor(Color.WHITE);       //设置文件颜色                ds.setUnderlineText(true);      //设置下划线            }            @Override            public void onClick(View widget) {            }        }, 0, url_1_text.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);       // mTvr21.setHighlightColor(Color.TRANSPARENT); //设置点击后的颜色为透明，否则会一直出现高亮        mTvr21.append(spStr1);        mTvr21.append(url_4_text);                        mTvr21.setMovementMethod(LinkMovementMethod.getInstance());//开始响应点击事件	return view;}OnClickListener listener =new OnClickListener() {		@Override	public void onClick(View v) {		switch (v.getId()) {		case R.id.mTvreg244:		     initDatao3();			break;		case R.id.mTvreg24:			initDatao1();			break;		case R.id.mTvreg24b:			if(ilistd1!=-1){				initDatao2();			}else{				Toast.makeText(getActivity(), R.string.ac1, 0).show();			}			break;		case R.id.mTvreg2:			showDialog();			break;		case R.id.mTvreg1:			showDialog1();			break;		case R.id.ui_login_btn:			if(TextUtils.isEmpty(mEtfr1.getEditableText().toString())){				Toast.makeText(getActivity(), getResources().getString(R.string.abc41), 0).show();			}else if(TextUtils.isEmpty(mEtfr3.getEditableText().toString())){				Toast.makeText(getActivity(), getResources().getString(R.string.abc42), 0).show();			}else if(TextUtils.isEmpty(mEtfr4.getEditableText().toString())){				Toast.makeText(getActivity(), getResources().getString(R.string.abc43), 0).show();			}			else{								initData();			}			break;		default:			break;		}	}};private void initData() {	downloadsearch("0");}public void downloadsearch(String area11){	progressBar_sale.setVisibility(View.VISIBLE);	 RequestParams params = new RequestParams();   List<NameValuePair> nameValuePairs=new ArrayList<NameValuePair>(10);   nameValuePairs.add(new BasicNameValuePair("number", mEtfr1.getEditableText().toString()));   nameValuePairs.add(new BasicNameValuePair("name", mEtfr2.getEditableText().toString()));   nameValuePairs.add(new BasicNameValuePair("wechatNo", iwechatNo+""));   nameValuePairs.add(new BasicNameValuePair("username", mEtfr3.getEditableText().toString()));   nameValuePairs.add(new BasicNameValuePair("password", mEtfr4.getEditableText().toString()));   if(ilistd1!=-1){	   nameValuePairs.add(new BasicNameValuePair("categoryOneID", listd1.get(ilistd1).oid));   }   if(ilistd2!=-1){	   nameValuePairs.add(new BasicNameValuePair("categoryTwoID", listd2.get(ilistd2).oid));   }   if(ilistd3!=-1){	   nameValuePairs.add(new BasicNameValuePair("locationOneID", listd3.get(ilistd3).oid));   }else{	   nameValuePairs.add(new BasicNameValuePair("locationOneID",1+""));   }         params.addBodyParameter(nameValuePairs);   HttpUtils http = new HttpUtils();   http.send(HttpRequest.HttpMethod.POST,  		 "http://pine.i3.com.hk/trade/json/adduser.php",           params,           new RequestCallBack<String>() {				private String msg;				@Override				public void onFailure(HttpException arg0, String arg1) {					// TODO Auto-generated method stub									}				@Override				public void onSuccess(ResponseInfo<String> arg0) {					JSONObject jsonObject;					try {						jsonObject = new JSONObject(arg0.result);						String string_code = jsonObject.getString("code");						 msg = jsonObject.getString("msg");												 int  num_code=Integer.valueOf(string_code);						 if (num_code==1) {							 //保存到本地							 JSONObject array = jsonObject.getJSONObject("data");								progressBar_sale.setVisibility(View.GONE);								 String id = array.getString("id");								SharedPreferences mySharedPreferences= getActivity().getSharedPreferences("USER", Activity.MODE_PRIVATE); 								SharedPreferences.Editor editor = mySharedPreferences.edit(); 								editor.putString("number",mEtfr1.getEditableText().toString()); 								editor.putString("name",mEtfr2.getEditableText().toString()); 								editor.putString("username",mEtfr3.getEditableText().toString()); 								editor.putString("wechatNo",iwechatNo+""); 								editor.putString("id",id); 								editor.commit(); 																				                if((iwechatNo+"").equals("1")){								startActivity(new Intent(getActivity(), MainActivity.class));				                }else{				    				startActivity(new Intent(getActivity(), MainActivity2.class));				                }				                getActivity().finish();						 /**						  * {"code":"1","msg":"Reg success","data":{"UserID":3,"LoginName":"\u5728","UserEmail":"ljppff@163.com"","UserName":null,"UserGender":1,"UserBirtyYear":null}}						  */						 }												 else {								 Toast.makeText(getActivity(),msg, 0).show();									progressBar_sale.setVisibility(View.GONE);							//new AlertInfoDialog(SaleActivity.this).show();						}					} catch (JSONException e) {						//new Dialog_noInternet(SaleActivity.this).show();						progressBar_sale.setVisibility(View.GONE);					}																			}        });}private void initDatao1() {	downloadsearcho1("0");}public void downloadsearcho1(String area11){	progressBar_sale.setVisibility(View.VISIBLE);	 RequestParams params = new RequestParams();   List<NameValuePair> nameValuePairs=new ArrayList<NameValuePair>(10);      params.addBodyParameter(nameValuePairs);   HttpUtils http = new HttpUtils();   http.send(HttpRequest.HttpMethod.POST,  		 "http://pine.i3.com.hk/trade/json/categoryonelist.php",           params,           new RequestCallBack<String>() {				private String msg;				@Override				public void onFailure(HttpException arg0, String arg1) {					// TODO Auto-generated method stub									}				@Override				public void onSuccess(ResponseInfo<String> arg0) {					JSONObject jsonObject;					try {						jsonObject = new JSONObject(arg0.result);						String string_code = jsonObject.getString("code");						 msg = jsonObject.getString("msg");												 int  num_code=Integer.valueOf(string_code);						 if (num_code==1) {							 //保存到本地							 listd1.clear();														 JSONArray array = jsonObject.getJSONArray("data");							 listd1s=new String[array.length()];							 for(int i=0;i<array.length();i++){																 Data1 d1 =new Data1();								 d1.oid=array.getJSONObject(i).getString("oid");								 d1.oname=array.getJSONObject(i).getString("oname");								 listd1.add(d1);								 listd1s[i]=d1.oname;							 }								progressBar_sale.setVisibility(View.GONE);                            initd1a();						 }												 else {								 Toast.makeText(getActivity(),msg, 0).show();									progressBar_sale.setVisibility(View.GONE);							//new AlertInfoDialog(SaleActivity.this).show();						}					} catch (JSONException e) {						//new Dialog_noInternet(SaleActivity.this).show();						progressBar_sale.setVisibility(View.GONE);						 Toast.makeText(getActivity(),msg, 0).show();						 e.printStackTrace();					}																			}				private void initd1a() {					 Dialog alertDialog = new AlertDialog.Builder(getActivity()). 				                setTitle(R.string.ac1)				                .setItems(listd1s, new DialogInterface.OnClickListener() { 				  				                    @Override 				                    public void onClick(DialogInterface dialog, int which) { 				                    //    Toast.makeText(Dialog_AlertDialogDemoActivity.this, arrayFruit[which], Toast.LENGTH_SHORT).show(); 				                    	ilistd1=which;				                    	mTvreg24.setText(listd1s[which]);				                    } 				                }). 				                setNegativeButton(R.string.ac3, new DialogInterface.OnClickListener() { 				 				                    @Override 				                    public void onClick(DialogInterface dialog, int which) { 				                        // TODO Auto-generated method stub  				                    } 				                }). 				                create(); 				        alertDialog.show(); 				}        });}class Data1 {	public String oid;	public String oname;}private void initDatao2() {	downloadsearcho2("0");}public void downloadsearcho2(String area11){	progressBar_sale.setVisibility(View.VISIBLE);	 RequestParams params = new RequestParams();   List<NameValuePair> nameValuePairs=new ArrayList<NameValuePair>(10);   nameValuePairs.add(new BasicNameValuePair("oid", listd1.get(ilistd1).oid));   params.addBodyParameter(nameValuePairs);   HttpUtils http = new HttpUtils();   http.send(HttpRequest.HttpMethod.POST,  		 "http://pine.i3.com.hk/trade/json/categorytwolist.php",           params,           new RequestCallBack<String>() {				private String msg;				@Override				public void onFailure(HttpException arg0, String arg1) {					// TODO Auto-generated method stub									}				@Override				public void onSuccess(ResponseInfo<String> arg0) {					JSONObject jsonObject;					try {						jsonObject = new JSONObject(arg0.result);						String string_code = jsonObject.getString("code");						 msg = jsonObject.getString("msg");												 int  num_code=Integer.valueOf(string_code);						 if (num_code==1) {							 //保存到本地							 listd2.clear();														 JSONArray array = jsonObject.getJSONArray("data");							 listd2s=new String[array.length()];							 for(int i=0;i<array.length();i++){																 Data2 d1 =new Data2();								 d1.oid=array.getJSONObject(i).getString("tid");								 d1.oname=array.getJSONObject(i).getString("tname");								 listd2.add(d1);								 listd2s[i]=d1.oname;							 }								progressBar_sale.setVisibility(View.GONE);                            initd1b();						 }												 else {								 Toast.makeText(getActivity(),msg, 0).show();									progressBar_sale.setVisibility(View.GONE);							//new AlertInfoDialog(SaleActivity.this).show();						}					} catch (JSONException e) {						//new Dialog_noInternet(SaleActivity.this).show();						progressBar_sale.setVisibility(View.GONE);						 Toast.makeText(getActivity(),msg, 0).show();						e.printStackTrace();					}																			}				private void initd1b() {					 Dialog alertDialog = new AlertDialog.Builder(getActivity()). 				                setTitle(R.string.ac2)				                .setItems(listd2s, new DialogInterface.OnClickListener() { 				  				                    @Override 				                    public void onClick(DialogInterface dialog, int which) { 				                    //    Toast.makeText(Dialog_AlertDialogDemoActivity.this, arrayFruit[which], Toast.LENGTH_SHORT).show(); 				                    	ilistd2=which;				                    	mTvreg24b.setText(listd2s[which]);				                    } 				                }). 				                setNegativeButton(R.string.ac3, new DialogInterface.OnClickListener() { 				 				                    @Override 				                    public void onClick(DialogInterface dialog, int which) { 				                        // TODO Auto-generated method stub  				                    } 				                }). 				                create(); 				        alertDialog.show(); 				}        });}class Data2 {	public String oid;	public String oname;}private void initDatao3() {	downloadsearcho3("0");}public void downloadsearcho3(String area11){	progressBar_sale.setVisibility(View.VISIBLE);	 RequestParams params = new RequestParams();   List<NameValuePair> nameValuePairs=new ArrayList<NameValuePair>(10);   params.addBodyParameter(nameValuePairs);   HttpUtils http = new HttpUtils();   http.send(HttpRequest.HttpMethod.POST,  		 "http://pine.i3.com.hk/trade/json/locationonelist.php",           params,           new RequestCallBack<String>() {				private String msg;				@Override				public void onFailure(HttpException arg0, String arg1) {					// TODO Auto-generated method stub									}				@Override				public void onSuccess(ResponseInfo<String> arg0) {					JSONObject jsonObject;					try {						jsonObject = new JSONObject(arg0.result);						String string_code = jsonObject.getString("code");						 msg = jsonObject.getString("msg");												 int  num_code=Integer.valueOf(string_code);						 if (num_code==1) {							 //保存到本地							 listd3.clear();														 JSONArray array = jsonObject.getJSONArray("data");							 listd3s=new String[array.length()];							 for(int i=0;i<array.length();i++){																 Data3 d1 =new Data3();								 d1.oid=array.getJSONObject(i).getString("locationoneid");								 d1.oname=array.getJSONObject(i).getString("locationonename");								 listd3.add(d1);								 listd3s[i]=d1.oname;							 }								progressBar_sale.setVisibility(View.GONE);                            initd1();						 }												 else {								 Toast.makeText(getActivity(),msg, 0).show();									progressBar_sale.setVisibility(View.GONE);							//new AlertInfoDialog(SaleActivity.this).show();						}					} catch (JSONException e) {						//new Dialog_noInternet(SaleActivity.this).show();						progressBar_sale.setVisibility(View.GONE);						 Toast.makeText(getActivity(),msg, 0).show();						e.printStackTrace();					}																			}				private void initd1() {					 Dialog alertDialog = new AlertDialog.Builder(getActivity()). 				                setTitle(R.string.ac4)				                .setItems(listd3s, new DialogInterface.OnClickListener() { 				  				                    @Override 				                    public void onClick(DialogInterface dialog, int which) { 				                    //    Toast.makeText(Dialog_AlertDialogDemoActivity.this, arrayFruit[which], Toast.LENGTH_SHORT).show(); 				                    	ilistd3=which;				                    	mTvreg244.setText(listd3s[which]);				                    } 				                }). 				                setNegativeButton(R.string.ac3, new DialogInterface.OnClickListener() { 				 				                    @Override 				                    public void onClick(DialogInterface dialog, int which) { 				                        // TODO Auto-generated method stub  				                    } 				                }). 				                create(); 				        alertDialog.show(); 				}        });}class Data3 {	public String oid;	public String oname;}private ArrayList<Integer> aa1; private void showDialog() {    Builder builder=new Builder(getActivity());    //设置对话框的图标    builder.setIcon(R.drawable.ic_launcher);    //设置对话框的标题    builder.setTitle("x癯錾年份");    //0: 默认第一个单选按钮被选中    final String[] arr1 =new String[116];    for(int i=0;i<=115;i++){    	arr1[i]=(i+1900)+"";    }    builder.setSingleChoiceItems(arr1, 0, new DialogInterface.OnClickListener(){        public void onClick(DialogInterface dialog, int which) {            String hoddy=arr1[which];            mTvreg2.setText(""+hoddy);        }    });        //添加一个确定按钮    builder.setPositiveButton(" _ 定 ", new DialogInterface.OnClickListener(){        public void onClick(DialogInterface dialog, int which) {                    }    });    //创建一个单选按钮对话框    AlertDialog dialog = builder.create();    dialog.show();}private void showDialog1() {    Builder builder=new Builder(getActivity());    //设置对话框的图标    builder.setIcon(R.drawable.ic_launcher);    //设置对话框的标题    builder.setTitle("x穹Q^");    //0: 默认第一个单选按钮被选中    builder.setSingleChoiceItems(R.array.people, 0, new DialogInterface.OnClickListener(){        public void onClick(DialogInterface dialog, int which) {            String hoddy=getResources().getStringArray(R.array.people)[which];            mTvreg1.setText(""+hoddy);        }    });        //添加一个确定按钮    builder.setPositiveButton(" _ 定 ", new DialogInterface.OnClickListener(){        public void onClick(DialogInterface dialog, int which) {                    }    });    //创建一个单选按钮对话框    AlertDialog dialog = builder.create();    dialog.show();}   }